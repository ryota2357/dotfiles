#!/usr/bin/env bash

set -euo pipefail
cd "$(dirname "$0")" || exit 1

main() {
    local output_file="_generated.nix"
    > "$output_file"

    write() {
        echo "$1" >> "$output_file"
    }

    write "# This file is generated by _generate_nix. Do not modify it manually."
    write "{"
    local file
    for file in *; do
        [[ -f $file && $file != _* ]] || continue
        write "  \"$file\" = ./. + \"/$file\";"
    done
    write "}"

    echo "Successfully generated $output_file"
}

main
